import{Marker as e,Icon as t,LatLng as s,Util as o}from"leaflet";export class SVGMarker extends e{initialize(e,t){this.name=SVGMarker,o.setOptions(this,t),this.options.icon=new p(t),this._latlng=new s(e)}}const r='\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 41" class="leaflet-zoom-animated leaflet-interactive leaflet-SVGIcon" style="width:25px">\n    <path d="M12.4 0C5.6 0-.02 5.76-.02 12.7-.02 15.12.4501 17.28 1.6 19.2L12.4 38.4 23.2 19.2C24.4 17.38 24.9 15.12 24.88 12.72 24.88 5.8 19.2 0 12.4 0z" />\n    <circle class="markerDot" cx="12.5" cy="12.5" r="5"/>\n</svg> ',n={square:"M21.44 0H3.66C1.70 0 0.10 1.87 0.10 4.18V24.03 C0.10 26.33 1.70 28.2 3.66 28.2H8.11L12.54 41L17 28.2H21.45C23.41 28.2 25 26.33 25 24.02V4.18C25 1.87 23.41 0 21.45 0Z",penta:"M0 14.0124 6.2456 0h12.492L24.8 14 12.4912 40.991z",pin:"M11 16.2V34a1.4 1.4 0 002.8 0V16.2a8.3 8.2 0 10-2.8 0zM15.2 27.4V34a2.8 2.7 0 01-5.5 0v-6.6c-5.7.7-9.7 3.3-9.7 6.6 0 3.9 5.3 6.8 12.4 6.8s12.4-2.9 12.4-6.8c0-3.4-4-6-9.7-6.6z"};let i;const l={},a={iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]};class c{static svgExport(e=null){let t=c.svgDeserialize(e);if(!t.querySelector("defs")&&"defs"!=t.tagName){const e=c.svgMaker("defs");e.appendChild(t),t=e}if(t.querySelector("svg")||"svg"==t.tagName)document.body.append(t);else{const e=function(){let e=document.querySelector("#defsSVG");if(!e){const t="http://www.w3.org/2000/svg";e=c.svgMaker("svg",{xmlns:t}),e.setAttribute("id","defsSVG"),document.body.appendChild(e)}return e}();e.appendChild(t),t=e}}static svgCreateShadow(e,t){let s=t.cloneNode(!0);s.querySelector("circle")?.remove();const o=s.querySelector("path");o.setAttribute("transform","rotate(45, 12, 41)"),o.setAttribute("filter","url(#shadowBlur)"),s.classList.add("SVGInvisible"),document.body.append(s);let r=document.querySelector(".SVGInvisible"),n=r.getBBox();document.body.removeChild(r),s.classList.remove("SVGInvisible"),n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=Math.round(n.width),n.height=Math.ceil(n.height),s.setAttribute("viewBox",`0 0 ${n.width} ${n.height}`),s.style.width=`${n.width}px`,s.classList.add("SVGMarkerShadow"),l[e]=s}static serializeSVG(e){return(new XMLSerializer).serializeToString(e)}static svgToDataURL(e){e instanceof SVGSVGElement&&(e=c.serializeSVG(e));return`data:image/svg+xml;base64,${btoa(e)}`}static svgDeserialize(e,t=!0){let s=null;try{const t=(new DOMParser).parseFromString(e,"image/svg+xml"),o=t.querySelector("parsererror");o&&console.warn("DOMParser error:",JSON.stringify(o)),s=t.documentElement}catch(t){console.warn(`svgDeserialize: ${t.name} ${t.message}`),console.warn("You might want to pass TrustedHTML"),s=c.kludge_svgDeserializer(e)}if(t){const e=function(t){if(3===t.nodeType)t.remove();else for(let s of t.childNodes)e(s)};e(s)}return s}static kludge_svgDeserializer(e){let t=[];const s=/((?<key>\w+)\s*=\s*(?<value>(['"])[^'"]*?\4))/g,o=/\/\s*>/;let r=e.matchAll(/<\s*(?<tagclose>[\/])?\s*(?<tag>\/?\w+)\s*(?<attribs>[^>]*)?>/g);const n=Array.from(r);for(const e of n){const{tagclose:r,tag:n,attribs:i}=e.groups;let l={};if(i?.length){let e=i.matchAll(s);const t=Array.from(e);for(const e of t){const{key:t,value:s}=e.groups;l[t.replace('"',"")]=s.slice(1,-1)}}let a=c.svgMaker(n,l);e[0].match(o)||r?(t.at(-1).appendChild(a),t.length>1&&t.pop()):t.push(a)}return t.pop()}static svgMaker(e,t){if(e.startsWith("/"))return null;const s=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e in t)s.setAttribute(e,t[e]);return s}}class p extends t{_createSVGIcon(e){let t=i.cloneNode(!0);const s=["glyphColor","glyphPrefix","imageOpts","keyboard","title","alt","zIndexOffset","opacity","raiseOnHover","pane","shadowPane","bubblingPointerEvents","autoPanOnFocus"];for(const[o,r]of Object.entries(e))if(!s.includes(o))if("shape"==o){if(r in n){t.querySelector("path").setAttribute("d",n[r])}else console.warn(`unknown shape: ${r}`);if("pin"==r){t.querySelector("circle").setAttribute("cy",8)}}else if("color"==o)if(CSS.supports("color",r))for(const e of t.children)e.setAttribute("fill",r),e.setAttribute("stroke",r);else console.warn(`color ${r} not supported`);else if("class"==o)for(let e of r.split(/\s+/))t.classList.add(e);else if("fill"==o)CSS.supports("color",r)&&(t.querySelector("path").style.fill=r);else if("stroke"==o)for(const e of t.children)e.setAttribute("stroke",r);else if("dotColor"==o)if(CSS.supports("color",r)){const e=t.querySelector(".markerDot");e&&(e.style.fill=r)}else console.warn(`color ${r} not supported`);else if("dotRadius"==o)t.querySelector(".markerDot")?.setAttribute("r",r);else if("image"==o){let s=r;if(s.startsWith("javascript")){console.warn("Bad image option %o",r);continue}if("string"==typeof s&&s.trim().match(/^<svg.*>/)&&(s=c.svgToDataURL(s)),s.match(/^[\.\/]/)){let e=document.createElement("a");e.setAttribute("href",s),s=e.href}if(!URL.canParse(s)){console.warn("Bad image option %o",r);continue}let o=e.imageOpts||{};o.href=s,o.width||(o.width=15),o.height||(o.height=15),o.width&&!o.x&&(o.x=(25-o.width)/2),o.height&&!o.y&&(o.y=(25-o.height)/2);let n=c.svgMaker("image",o);t.appendChild(n),n=t.querySelector(".markerDot"),n&&n.setAttribute("r",0)}else if("glyph"==o||"number"==o){let s=document.createElement("span");if("glyph"==o){const t=e.glyphPrefix||r.split("-")[0];s.className=`${t} ${r}`}else s.textContent=r;s.classList.add("SVGIconGlyph");const n=e.glyphColor||"white";CSS.supports("color",n)?s.style.color=n:(console.warn(`Bad glyphColor ${e.glyphCOlor}`),s.style.color="white");let i=c.svgMaker("foreignObject",{x:0,y:0});i.style.height=`${this.options.iconSize[1]}px`,i.style.width=`${this.options.iconSize[0]}px`,i.appendChild(s),t.appendChild(i),t.querySelector(".markerDot")?.setAttribute("r",0)}else if("style"==o){const e=c.svgMaker("style");e.append(r),t.prepend(e)}else for(const e of t.children)e.style[o]=r;return t}createIcon(){const e=this._options||{};let t;t=Object.keys(e).length?this._createSVGIcon(e):i.cloneNode(!0);const s=this.options.iconAnchor;return t.style.marginLeft=-s[0]+"px",t.style.marginTop=-s[1]+"px",t}createShadow(e){const t=this.options.shape||"default";return l[t].cloneNode(!0)}initialize(e){i||(i=c.svgDeserialize(r)),this.name=p,this._options=e,this.options={...a,...e}}}export{SVGMarker as default,p as SVGIcon,c as SVGMarkerUtil};!function(){const e=new CSSStyleSheet;e.replaceSync("\n.leaflet-SVGIcon {\n  fill: #267fca;\n  stroke: blue;\n  width: 25px;\n  height: 41px;\n  /* filter: drop-shadow(5px -5px 5px rgba(0, 0, 0, 0.6)); */\n}\n.leaflet-SVGIcon .markerDot {\n  fill:white;\n}\nspan.SVGIconGlyph {\n  width: 25px;\n  text-align: center;\n  vertical-align: middle;\n  position: relative;\n  display: inline-block;\n}\nsvg.SVGMarkerShadow {\n  opacity: 0.7;\n  top: -41px; \n  left: -12px;\n}\n.SVGMarkerShadow path {\n  stroke: #666;\n  fill: #666;\n}\n.SVGInvisible {\n  opacity: 0;\n  left: -10000px;\n  top: -10000px;\n}\n#defsSVG {\n  display: none;\n}\n"),document.adoptedStyleSheets.push(e)}(),i=c.svgDeserialize(r,!0),c.svgExport('\n<svg xmlns="http://www.w3.org/2000/svg" id="defsSVG">\n  <defs>\n    <filter id="shadowBlur">\n      <feGaussianBlur in="SourceGraphic" stdDeviation="2.5" />\n    </filter>\n  </defs>\n</svg>'),function(){const e=i.cloneNode(!0);c.svgCreateShadow("default",e);for(const[t,s]of Object.entries(n))e.querySelector("path").setAttribute("d",s),c.svgCreateShadow(t,e)}();